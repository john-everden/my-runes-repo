name: Scan for secret filenames

on:
  push:
    paths:
      - '**/*'
  pull_request:
    paths:
      - '**/*'

jobs:
  secret-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Find suspicious filenames
        run: |
          set -e
          # Patterns that must not be committed
          patterns="(^|/)(secret|secret\.|.*\.gpg|.*\.pem|.*\.key|.*private.*|.*id_rsa).*"
          matches=$(git ls-files | grep -Ei "$patterns" || true)
          if [ -n "$matches" ]; then
            echo "ERROR: Found files matching forbidden patterns:"
            echo "$matches"
            exit 1
          fi
      - name: Run runestone verifier
        run: |
          chmod +x ./verify.sh || true
          ./verify.sh

